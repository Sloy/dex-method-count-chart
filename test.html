<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Dex Method Count</title>
    <style>
        .has-children > a {
            color: blue;
        }

        .has-children:hover > a {
            color:orange;
            text-decoration:none;
            cursor:pointer;
        }
    </style>
    <script src="js/Chart.js"></script>
    <script src="js/jquery-2.1.3.min.js"></script>
    <script type="text/javascript">
        var chart;
        var colors = ["#F7464A", "#46BFBD", "#FDB45C", "#D32F2F", "#512DA8", "#303F9F", "#E64A19"];
        function color(index) {
            return colors[index % colors.length];
        }

        function showChart(jsonDataArray) {
            // Clear
            if(chart) {
                chart.destroy();
            }
            var options = {};
            // Get context with jQuery - using jQuery's .get() method.
            var ctx = $("#myChart").get(0).getContext("2d");
            // This will get the first returned node in the jQuery collection.
            chart = new Chart(ctx).Pie({}, options);
            setChartData(jsonDataArray);
        }

        function setChartData(jsonDataArray) {
            $.each(jsonDataArray, function (i, node) {
                var dataItem = {
                    value: node.count,
                    label: node.name,
                    color: color(i),
                    highlight: "#FF5A5E"
                };
                chart.addData(dataItem);
            });
        }

        function showList(jsonDataArray) {
            var $listRoot = $("#list-root");
            var $list = $("<ul/>")
                    .appendTo($listRoot);

            generateList($list, jsonDataArray);
            setListeners();
        }

        function generateList($listItem, nodeArray) {
            $.each(nodeArray, function (i, node) {
                var $li = $('<li/>')
                        .appendTo($listItem);
                var $a = $('<a/>')
                        .text(node.name+" - "+node.count)
                        .addClass("package")
                        .appendTo($li);

                if(node.children.length>0) {
                    $li.addClass("has-children");
                    var $childUl = $('<ul/>')
                            .hide()
                            .appendTo($li);
                    $a.click(function () {
                        nodeClicked(node);
                        expandChildList($childUl);
                    });
                    generateList($childUl, node.children);
                }else {
                    $li.addClass("no-children");
                }
            });
        }

        $(function () {
            $.ajax({
                url: 'data.json',
                dataType: 'text',
                success: function (data) {
                    var json = $.parseJSON(data);

                    var firstLevel = json.children;

                    showChart(firstLevel);
                    showList(firstLevel)
                }
            })
        });

        function expandChildList($ulChild) {
            $ulChild.show();
        }

        function setListeners() {
            $(".package").click(function(event) {
                var $itemClicked = $(event.target);
                expandChildList($itemClicked.next());
            })
        }

        function nodeClicked(node) {
            console.log("nodeClicked: " + node.name);
            showChart(node.children)
        }
    </script>
</head>
<body>

<canvas id="myChart" width="400" height="400"></canvas>

<div id="list-root"></div>

</body>

</html>